<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Lecteur EPUB</title>
    
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         ANTI-FOUC (Flash of Unstyled Content)
         Script critique pour appliquer le thÃ¨me AVANT le rendu de la page.
         DOIT Ãªtre exÃ©cutÃ© en premier, avant tous les CSS et JS.
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <script>
        (function() {
            'use strict';
            
            // RÃ©cupÃ©rer la prÃ©fÃ©rence stockÃ©e
            var storedPreference = localStorage.getItem('epub_theme') || 'auto';
            var appliedTheme = null;
            
            // DÃ©terminer le thÃ¨me systÃ¨me
            function getSystemTheme() {
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    return 'dark';
                }
                return 'light';
            }
            
            // RÃ©soudre le thÃ¨me Ã  appliquer
            if (storedPreference === 'auto') {
                appliedTheme = getSystemTheme();
            } else {
                appliedTheme = storedPreference;
            }
            
            // Appliquer la classe immÃ©diatement sur le <body>
            // Note: On utilise <html> au lieu de <body> car <body> n'existe pas encore
            var root = document.documentElement;
            
            // Supprimer toutes les classes de thÃ¨me existantes
            root.className = root.className.replace(/\b(dark-theme|sepia-theme)\b/g, '').trim();
            
            // Ajouter la classe du thÃ¨me appliquÃ©
            if (appliedTheme === 'dark') {
                root.classList.add('dark-theme');
            } else if (appliedTheme === 'sepia') {
                root.classList.add('sepia-theme');
            }
            // Note: Sidebar icons are now rendered via CSS variables (--icon-library, --icon-favorites, etc.)
            // No manual update needed - CSS handles theme switching automatically
            
            // DÃ©sactiver les transitions CSS au chargement initial (anti-glitch)
            root.style.setProperty('--transition-duration', '0s');
            
            // RÃ©activer les transitions aprÃ¨s un court dÃ©lai
            window.addEventListener('DOMContentLoaded', function() {
                setTimeout(function() {
                    root.style.removeProperty('--transition-duration');
                }, 100);
            });
        })();
    </script>
    
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         PWA - Progressive Web App
         Manifeste, thÃ¨me et icÃ´nes pour installation native
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#6366f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="EPUB Reader">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Lecteur EPUB">
    <meta name="msapplication-TileColor" content="#6366f1">
    <meta name="msapplication-tap-highlight" content="no">
    
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         FONTS
         Inter pour l'interface, polices systÃ¨me en fallback
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         STYLESHEETS
         themes.css  : Variables CSS pour les 3 thÃ¨mes (light, dark, sepia)
         base.css    : Reset, variables et composants communs
         mobile.css  : Styles spÃ©cifiques mobile (boutons flottants, dropdowns)
         desktop.css : Styles spÃ©cifiques desktop (barres, hover states)
         loader.css  : Composant de feedback visuel pour opÃ©rations longues
         sort.css    : Composant de tri de la bibliothÃ¨que
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <link rel="stylesheet" href="css/themes.css">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/mobile.css">
    <link rel="stylesheet" href="css/desktop.css">
    <link rel="stylesheet" href="css/components/loader.css">
    <link rel="stylesheet" href="css/components/sort.css">
    <link rel="stylesheet" href="css/components/stats.css">
    <link rel="stylesheet" href="css/library.css">
    
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         STYLES BOTTOM SHEET (SOMMAIRE MOBILE)
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         LIBRARIES
         JSZip  : Extraction des mÃ©tadonnÃ©es EPUB
         epub.js: Moteur de lecture EPUB
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/epubjs@0.3.93/dist/epub.min.js"></script>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     BIBLIOTHÃˆQUE
     Vue principale avec sidebar de navigation et grille de livres
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="library-view" id="libraryView">
    
    <!-- Sidebar latÃ©rale -->
    <div class="lib-sidebar">
        <div class="sidebar-icon active sidebar-icon-library" title="BibliothÃ¨que" data-action="show-library-view" data-view="all"></div>
        <div class="sidebar-icon sidebar-icon-favorites" title="Favoris" data-action="show-library-view" data-view="favorites"></div>
        <div class="sidebar-icon sidebar-icon-stats" title="Statistiques" data-action="show-library-view" data-view="stats"></div>
        <div class="sidebar-icon sidebar-icon-settings" style="margin-top: auto;" data-action="open-settings" title="ParamÃ¨tres"></div>
    </div>
    
    <!-- Zone principale -->
    <div class="lib-main">
        <div class="lib-container">
            
            <!-- En-tÃªte avec titre, recherche et actions -->
            <div class="lib-header">
                <h1>BibliothÃ¨que</h1>
                <div class="lib-search-bar">
                    <input type="text" class="search-input" placeholder="Rechercher un livre..." id="searchInput">
                </div>
                <div class="lib-actions">
                    <div class="lib-sort-dropdown" id="sortDropdown">
                        <button class="btn btn-secondary" id="sortBtn" data-action="toggle-sort-menu" title="Trier par...">
                            <span>â†•</span> Trier
                        </button>
                        <div class="sort-menu" id="sortMenu">
                            <div class="sort-option" data-sort="added_desc">ğŸ“… Plus rÃ©cents</div>
                            <div class="sort-option" data-sort="added_asc">ğŸ“… Plus anciens</div>
                            <div class="sort-option" data-sort="title_asc">ğŸ“– Titre (Aâ†’Z)</div>
                            <div class="sort-option" data-sort="title_desc">ğŸ“– Titre (Zâ†’A)</div>
                            <div class="sort-option" data-sort="author_asc">âœï¸ Auteur (Aâ†’Z)</div>
                            <div class="sort-option" data-sort="author_desc">âœï¸ Auteur (Zâ†’A)</div>
                            <div class="sort-option" data-sort="progress_desc">ğŸ“– En cours</div>
                        </div>
                    </div>
                    <button class="btn btn-primary" data-action="import">+</button>
                </div>
            </div>
            
            <!-- Grille des livres -->
            <div class="lib-books" id="booksList"></div>
            
        </div>
    </div>
    
    <!-- Input cachÃ© pour l'import de fichiers -->
    <input type="file" id="fileInput" accept=".epub" />
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MODALE DÃ‰TAILS DU LIVRE
     Affiche les informations complÃ¨tes d'un livre
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="book-modal" id="bookModal">
    <div class="book-modal-content" id="bookModalContent">
        <!-- Contenu gÃ©nÃ©rÃ© dynamiquement par UIManager -->
    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     LECTEUR EPUB
     Architecture Mobile-First - Interface Ã©purÃ©e
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="reader-view" id="readerView">
    
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         MOBILE : Boutons flottants minimalistes (haut de l'Ã©cran)
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    
    <!-- Bouton flottant gauche : Sommaire -->
    <div class="mobile-float-left" id="mobileFloatLeft">
        <!-- Bouton Sommaire (ouvre dropdown) -->
        <button class="float-btn" id="btnTocToggle" data-action="toggle-toc" title="Sommaire" aria-label="Sommaire">
            <span>â˜°</span>
        </button>
    </div>
    
    <!-- Boutons flottants droite : RÃ©glages + Fermer -->
    <div class="mobile-float-right" id="mobileFloatRight">
        <!-- Bouton RÃ©glages (ouvre dropdown) -->
        <button class="float-btn" id="btnSettingsToggle" data-action="toggle-mobile-settings" title="RÃ©glages" aria-label="RÃ©glages">
            <span>âš™</span>
        </button>
        <button class="float-btn" data-action="close-reader" title="Fermer" aria-label="Fermer le livre">
            <span>âœ•</span>
        </button>
    </div>
    
    <!-- Dropdown RÃ©glages (apparaÃ®t sous le bouton âš™) -->
    <div class="mobile-dropdown" id="settingsDropdown">
        <div class="dropdown-section">
            <div class="dropdown-label">Taille du texte</div>
            <div class="dropdown-row">
                <button class="dropdown-btn" data-action="font-decrease">Aâˆ’</button>
                <span class="dropdown-value" id="dropdownFontSize">100%</span>
                <button class="dropdown-btn" data-action="font-increase">A+</button>
            </div>
        </div>
        <div class="dropdown-section">
            <div class="dropdown-label">Mode de lecture</div>
            <div class="dropdown-row">
                <button class="dropdown-btn-wide" data-action="set-flow-scroll" id="dropdownFlowScroll">ğŸ“œ DÃ©filement</button>
                <button class="dropdown-btn-wide" data-action="set-flow-paginated" id="dropdownFlowPaginated">ğŸ“– Pages</button>
            </div>
        </div>
        <div class="dropdown-section">
            <div class="dropdown-label">ThÃ¨me</div>
            <div class="dropdown-row">
                <button class="dropdown-theme-btn theme-light" data-action="set-theme-light" title="Clair">â˜€ï¸</button>
                <button class="dropdown-theme-btn theme-dark" data-action="set-theme-dark" title="Sombre">ğŸŒ™</button>
                <button class="dropdown-theme-btn theme-sepia" data-action="set-theme-sepia" title="SÃ©pia">ğŸ“œ</button>
            </div>
        </div>
    </div>
    
    <!-- Overlay pour fermer les dropdowns (RestaurÃ© pour le menu paramÃ¨tres) -->
    <div class="mobile-dropdown-overlay" id="mobileDropdownOverlay"></div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         NOUVEAU SOMMAIRE MOBILE (BOTTOM SHEET)
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="bottom-sheet-overlay" id="bottomSheetOverlay" data-action="close-toc"></div>
    <div class="bottom-sheet" id="tocBottomSheet" aria-hidden="true">
        <div class="bottom-sheet-handle-area"><div class="bottom-sheet-handle"></div></div>
        <div class="bottom-sheet-header" style="justify-content: center; padding: 0 24px 16px;">
            <div style="position: relative; width: 100%; max-width: 280px;">
                <input type="text" id="tocSearchInput" placeholder="Rechercher un chapitre..." style="width: 100%; padding: 10px 48px 10px 16px; border-radius: 12px; border: 1px solid var(--border); background: var(--bg); color: var(--text); font-size: 0.95rem; outline: none; text-align: center; transition: border-color 0.2s, box-shadow 0.2s;">
                <button id="tocSearchClear" style="position: absolute; right: 0; top: 0; height: 100%; width: 48px; background: none; border: none; color: var(--text-muted); cursor: pointer; display: none; align-items: center; justify-content: center; font-size: 1.1rem; border-radius: 0 12px 12px 0;" aria-label="Effacer la recherche">âœ•</button>
            </div>
        </div>
        <div class="bottom-sheet-content">
            <ul class="sheet-toc-list" id="tocListMobile"></ul>
        </div>
    </div>
    
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         ZONE PRINCIPALE : Contenu du livre (plein Ã©cran)
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <main class="reader-content" id="readerContent">
        <div id="viewer"></div>
    </main>
    
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         DESKTOP : Barres flottantes (masquÃ©es sur mobile)
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="floating-bar floating-bar-left" id="floatingBarLeft">
        <button data-action="toggle-toc" title="Sommaire">â˜°</button>
        <div class="floating-title" id="readerTitle">Chargement...</div>
    </div>
    
    <div class="floating-bar floating-bar-right" id="floatingBarRight">
        <button data-action="font-decrease" title="RÃ©duire la police">Aâˆ’</button>
        <button data-action="font-increase" title="Agrandir la police">A+</button>
        <button data-action="toggle-flow" id="flowToggleBtn" title="Mode pagination">ğŸ“„</button>
        <button data-action="toggle-theme" title="Changer le thÃ¨me">ğŸŒ™</button>
        <button data-action="close-reader" title="Fermer">âœ•</button>
    </div>
    
    <!-- Sidebar du sommaire Desktop -->
    <aside class="toc-sidebar" id="tocSidebar">
        <div class="toc-header">
            <div class="toc-title">Sommaire</div>
            <button class="toc-close" data-action="toggle-toc" aria-label="Fermer le sommaire">âœ•</button>
        </div>
        <ul class="toc-list" id="tocList">
            <!-- Contenu gÃ©nÃ©rÃ© dynamiquement par ReaderEngine -->
        </ul>
    </aside>
    <div class="toc-overlay" id="tocOverlay" data-action="toggle-toc"></div>
    
    <!-- Barre de progression -->
    <div class="progress-bar" id="progressBar"></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MESSAGE DE STATUT
     Notifications temporaires (import, erreurs, etc.)
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="status-message" id="statusMessage"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCRIPTS MODULES
     Architecture modulaire avec ES Modules
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script type="module" src="js/core/app.js"></script>

</body>
</html>
